{#
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 # http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-#}
{% extends "base.html" %}


{% macro project_snippet(release) -%}

{% set version = release.version %}
{% set uploader_username = release.uploader.username %}
{% set uploader_name = release.uploader.name|default(uploader_username, true) %}

<div class="package-snippet">
  <h3 class="title"><a href="{{ request.route_path('packaging.project', name=release.project.normalized_name) }}">{{ release.project.name }}</a></h3>

  <p class="meta" {{ l20n("packageSnippetMeta", version=version, user=uploader_name) }}>
    <span class="version">{{ version }}</span> by <a href="{{ request.route_path('accounts.profile', username=uploader_username) }}">{{ uploader_name }}</a>
  </p>

  <p class="description">{{ release.summary }}</p>
</div>
{%- endmacro %}


{% block title %}{{ release.project.name }}{% endblock %}

{% block content %}
<section class="banner-block ">
  <div class="package-header">
    <p class="license" {{ l20n("projectLicense", license="TODO") }}>License: <a href="TODO">TODO</a></p>
    <h1>{{ release.project.name }} {{ release.version }}</h1>
    <p class="description">{% if release.summary %}{{ release.summary }}{% endif %}</p>

    <p class="pip-instructions">
      <span>pip install {{ release.project.normalized_name }}</span>
      <a href="clicking-here-copies-text"><i class="fa fa-copy"></i></a>
    </p>

    <p class="help-link"><a href="#" {{ l20n("howToInstall") }}>How do I install this?</a></p>
  </div>
</section>

<section class="package-status">
  <div class="site-container">
    {% if release.version != all_releases[0].version %}
    <a class="status-badge -bad" {{ l20n("newerVersionAvailable", version=all_releases[0].version) }} href="{{ request.route_path('packaging.release', name=release.project.name, version=all_releases[0].version) }}">Newer version available ({{ all_releases[0].version }})</a>
    {% else %}
    <a class="status-badge -good" {{ l20n("latestVersion") }} href="{{ request.route_path('packaging.release', name=release.project.name, version=release.version) }}">Latest Version</a>
    {% endif %}

    {# TODO: We need to actually make these do something. #}
    <a class="status-badge -unknown" {{ l20n("depStatusUnknown") }} href="#">Dependencies status unknown</a>
    <a class="status-badge -unknown" {{ l20n("testStatusUnknown") }} href="#">Test status unknown</a>
    <a class="status-badge -unknown" {{ l20n("testCoverageUnknown") }} href="#">Test coverage unknown</a>
  </div>
</section>

<section class="horizontal-section -grey -thin">
  <div class="site-container">
    <div class="split-layout">
      <nav class="horizonal-menu">
        {% if release.home_page %}
        <a class="link" {{ l20n("projectHomepage") }} href="{{ release.home_page }}" rel="nofollow"><i class="fa fa-home"></i>Homepage</a>
        {% endif %}

        {# TODO: We need to actually pull these from project-urls and do some detection here #}
        <a class="link" href="#" rel="nofollow"><i class="fa fa-github"></i>Source Code (TODO)</a>
        <a class="link" href="#" rel="nofollow"><i class="fa fa-book"></i>Documentation (TODO)</a>
        <a class="link" href="#" rel="nofollow"><i class="fa fa-slack"></i>Slack (TODO)</a>

        {% if release.download_url %}
        <a class="link" {{ l20n("projectDownloadURL") }} href="{{ release.download_url }}" rel="nofollow"><i class="fa fa-external-link-square"></i>Download</a>
        {% endif %}
      </nav>
      <p class="author-info">
        <span {{ l20n("releasedAgoBy", when=release.created|format_date(), by=release.uploader.name|default(release.uploader.username, true)) }}>Released <time class="-js-relative-time" datetime="{{ release.created|format_datetime('yyyy-MM-ddTHH:mm:ss') }}Z">{{ release.created|format_datetime() }}</time> by <a href="{{ request.route_path('accounts.profile', username=release.uploader.username) }}">{{ release.uploader.name|default(release.uploader.username, true) }}</a></span>
        <a href="{{ request.route_path('accounts.profile', username=release.uploader.username) }}"><img src="{{ gravatar(release.uploader.email, size=40) }}" height="40" width="40" alt="{{ release.uploader.name|default(release.uploader.username, true) }}"></a>
      </p>
    </div>
  </div>
</section>

<section>
  <div class="site-container">
    <div class="vertical-tabs-container">
      <div class="vertical-tabs">
        <div class="sidebar-section">
          <h3 {{ l20n("projectNavigation") }}>Navigation</h3>
            <a class="js-vertical-tab vertical-tab is-active" rel="tab1" {{ l20n("projectDescription") }}>Project Description</a>
            <a class="js-vertical-tab vertical-tab" rel="tab2" {{ l20n("projectDependencies") }}>Dependencies</a>
            <a class="js-vertical-tab vertical-tab" rel="tab3" {{ l20n("projectHistory") }}>Version History &amp; Changelog</a>
            <a class="js-vertical-tab vertical-tab" rel="tab4" {{ l20n("projectDownloadStats") }}>Download Statistics</a>
            <a class="js-vertical-tab vertical-tab" rel="tab5" {{ l20n("projectFiles") }}>Files</a>
        </div>

        <div class="sidebar-section maintainers">
          <h3 {{ l20n("projectMaintainers") }}>Maintainers</h3>
          {% for maintainer in maintainers %}
          <a href="{{ request.route_path('accounts.profile', username=maintainer.username) }}"><img src="{{ gravatar(maintainer.email, size=50) }}" height="50" width="50" alt="{{ maintainer.username}}"></a>
          {% endfor %}
        </div>

        {% if release.has_meta %}
        <div class="sidebar-section meta">
          <h3 {{ l20n("projectMeta") }}>Meta</h3>
          {% if release.keywords %}
          <p class="tags"><i class="fa fa-tags"></i> {{ release.keywords }}</p>
          {% endif %}
        </div>
        {% endif %}
      </div>

      <div class="vertical-tab-content-container">
        {# Tab: Project Description #}
        <a class="js-vertical-tab-accordion-heading vertical-tab-accordion-heading is-active" rel="tab1" {{ l20n("projectDescription") }}>Project Description</a>
        <div id="tab1" class="js-vertical-tab-content vertical-tab-content">
          {% if release.description %}
            {{ release.description|readme(format="rst") }}
          {% endif %}
        </div>

        {# Tab: Dependencies #}
        <a class="js-vertical-tab-accordion-heading vertical-tab-accordion-heading" rel="tab2" {{ l20n("projectDependencies") }}>Dependencies</a>
        <div id="tab2" class="js-vertical-tab-content vertical-tab-content">
          <h2 {{ l20n("numberProjectDependencies", number="TODO") }}>Dependencies (TODO)</h2>
          <p {{ l20n("projectDependenciesInfo", name=release.project.name) }}>
            To run <em>{{ release.project.name }}</em>, you will need to have the following projects installed:
          </p>

          <div class="package-list">
            {% for _ in [1, 2] %}
              {{ project_snippet(release) }}
            {% endfor %}
          </div>

          <h2 {{ l20n("numberProjectReverseDependencies", number="TODO") }}>Reverse Dependencies (TODO)</h2>
          <p {{ l20n("projectReverseDependenciesInfo", name=release.project.name) }}>
            The following projects rely on <em>{{ release.project.name }}</em>:
          </p>

          <div class="package-list">
            {% for _ in [1, 2, 3] %}
              {{ project_snippet(release) }}
            {% endfor %}
          </div>
        </div>

        {# Tab: Version History & Changelog #}
        <a class="js-vertical-tab-accordion-heading vertical-tab-accordion-heading" rel="tab3" {{ l20n("projectHistory") }}>Version History &amp; Changelog</a>
        <div id="tab3" class="js-vertical-tab-content vertical-tab-content">
          <div class="split-layout">
            <h2 {{ l20n("projectHistory") }}>Version History &amp; Changelog</h2>
            <a class="wh-button -js-toggle" {{ l20n("expandAll") }} href="#">Expand All</a>
          </div>

          <section class="version-history-graphic">
            {% for hrelease in all_releases %}
              {% set is_current = (hrelease.version == release.version) %}
              <div class="history-section{% if loop.first %} latest{% elif loop.last %} oldest{% endif %}{% if is_current %} current{% endif %}">
                <div class="version">
                  {% if is_current %}
                    <p>{{ hrelease.version }}</p>
                    <span class="highlight-badge" {{ l20n("thisVersion") }}>This version</span>
                  {% else %}
                    <p><a href="{{ request.route_path('packaging.release', name=release.project.name, version=hrelease.version) }}">{{ hrelease.version }}</a></p>
                  {% endif %}
                </div>

                <div class="graphic">
                  <div class="line"></div>
                  {% if is_current %}
                    <img class="history-node" {{ l20n("historyNode") }} alt="History Node" src="{{ request.static_url('warehouse:static/dist/images/white-cube-small.png') }}">
                  {% else %}
                    <img class="history-node" {{ l20n("historyNode") }} alt="History Node" src="{{ request.static_url('warehouse:static/dist/images/blue-cube-small.png') }}">
                  {% endif %}
                </div>

                <div class="changelog">
                  <div class="card">
                    <p>TODO: Figure out how to actually get changelog content.
                    <p>Changelog content for this version goes here.</p>
                    <p>Donec et mollis dolor. Praesent et diam eget libero egestas mattis sit amet vitae augue. Nam tincidunt congue enim, ut porta lorem lacinia consectetur. Donec ut libero sed arcu vehicula ultricies a non tortor. Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                    <p><a href="clicking-here-expands-changelog"><i class="fa fa-plus-square-o"></i> <span {{ l20n("showMore") }}>Show More</span></a></p>
                  </div>
                </div>
              </div>
            {% endfor %}
          </section>
        </div>

        {# Tab: Statistics #}
        <a class="js-vertical-tab-accordion-heading vertical-tab-accordion-heading" rel="tab4" {{ l20n("projectDownloadStats") }}>Download Statistics</a>
        <div id="tab4" class="js-vertical-tab-content vertical-tab-content">
          <h2 {{ l20n("projectDownloadStats") }}>Download Statistics</h2>
          <div class="button-set">
            <a class="wh-button -highlight" href="#" {{ l20n("allVersions") }}>All versions</a>
            <a class="wh-button" href="#" {{ l20n("thisVersionOnly", version=release.version) }}>This version only ({{ release.version }})</a>
          </div>

          <div class="download-graph">
            <div class="download-overview">
              <p><strong>TODO:</strong> All of these numbers</p>
              <p><strong>Today:</strong> 34</p>
              <p><strong>This Week:</strong> 54</p>
              <p><strong>This Month: </strong> 5,434</p>
              <p><strong>This Year: </strong> 46,339</p>
              <p><strong>All Time:</strong> 2,342,323</p>
            </div>
            <p>TODO: Bar chart here showing downloads over time</p>
          </div>
        </div>

        {# Tab: Files #}
        <a class="js-vertical-tab-accordion-heading vertical-tab-accordion-heading" rel="tab5" {{ l20n("projectFiles") }}>Files</a>
        <div id="tab5" class="js-vertical-tab-content vertical-tab-content">
          <h2 {{ l20n("projectFilesTitle") }}>Release Files</h2>
          <p>TODO: Brief introduction on what you do with files - including link to relevant help section.</p>

          <table class="downloads-table">
            <thead>
              <tr>
                <th class="filename" {{ l20n("fileName") }}>File Name</th>
                <th class="checksum"><span {{ l20n("md5Checksum") }}>MD5 Checksum</span> <a href="TODO"><i class="fa fa-question-circle"></i></a></th>
                <th class="type" {{ l20n("fileType") }}>File Type</th>
                <th class="upload-date" {{ l20n("uploadDate") }}>Upload Date</th>
                <th class="version" {{ l20n("version") }}>Version</th>
              </tr>
            </thead>
            <tbody>
              {% for file in files %}
                <tr>
                  <td><a href="{{ request.route_path('packaging.file', path=file.path) }}">{{ file.filename }}</a>{% if file.size %} ({{ file.size|filesizeformat() }}){% endif %}</td>
                  <td>{{ file.md5_digest }}<a class="md5-link" href="clicking-here-copies-md5"><i class="fa fa-copy"></i></a></td>
                  <td>
                    {# TODO: This should ideally be part of an enum somewhere or
                       otherwise defined somewhere other than a big if else
                       chain inside of a template
                    #}
                    {% if file.packagetype == "bdist_dmg" %}
                      OSX Disk Image
                    {% elif file.packagetype == "bdist_dumb" %}
                      "Dumb" Binary
                    {% elif file.packagetype == "bdist_egg" %}
                      Egg
                    {% elif file.packagetype == "bdist_msi" %}
                      Windows MSI Installer
                    {% elif file.packagetype == "bdist_rpm" %}
                      RPM
                    {% elif file.packagetype == "bdist_wheel" %}
                      Wheel
                    {% elif file.packagetype == "bdist_wininst" %}
                      Windows Installer
                    {% elif file.packagetype == "sdist" %}
                      Source
                    {% else %}
                      {{ file.packagetype }}
                    {% endif %}
                  </td>
                  <td>{{ file.upload_time|format_date() }}</td>
                  <td>{% if file.python_version != "source" %}{{ file.python_version }}{% endif %}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</section>
{% endblock %}
